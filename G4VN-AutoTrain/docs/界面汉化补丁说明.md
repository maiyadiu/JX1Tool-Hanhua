# 界面汉化补丁说明

## 问题分析

您看到的越南文乱码界面是**目标程序（G4VNVLBS.exe）**的界面，而不是启动器程序（G4VN-AutoTrain.exe）的界面。

启动器程序只是用来：
1. 启动目标程序
2. 对目标程序进行破解
3. 修改目标程序的某些字符串

但是目标程序本身的界面文本是硬编码在程序中的，需要通过**运行时内存补丁**来修改。

## 解决方案

我已经创建了一个**界面中文补丁系统**（`UIChinesePatcher.cs`），它会：

1. **自动检测目标程序的所有窗口**
2. **递归遍历所有子窗口**（按钮、标签、文本框等）
3. **将越南文文本翻译为中文**
4. **持续监控并更新**（因为某些文本可能会动态更新）

## 新增文件

### UIChinesePatcher.cs

这是一个新的类，包含：

- **翻译映射表**：包含所有常见的越南文到中文的翻译
- **PatchAllWindows**：对目标程序的所有窗口进行补丁
- **PatchWindowRecursive**：递归补丁窗口及其子窗口
- **StartContinuousPatching**：持续监控并补丁动态更新的文本

## 已集成的功能

补丁系统已经集成到 `CrackVLBS19v3.cs` 中：

1. **VLBS 1.9 版本**：在破解完成后自动启动界面补丁
2. **VLBS 1.3 版本**：在破解完成后自动启动界面补丁

## 翻译映射表

补丁系统包含以下翻译：

| 越南文 | 中文 |
|--------|------|
| Tổng hợp | 综合 |
| Đồ tẩu | 挂机 |
| Thống kê | 统计 |
| Bang hội | 帮会 |
| Luyện công | 练功 |
| Nhiệm vụ Dã tẩu | 日常任务 |
| PT Nhiệm vụ | PT任务 |
| Túi vô | 背包 |
| Về thành | 回城 |
| Tử vong | 死亡 |
| Thu nhặt | 拾取 |
| ... | ... |

（完整列表请查看 `UIChinesePatcher.cs` 文件）

## 使用方法

**无需额外操作！** 补丁系统会在目标程序启动后自动运行。

## 工作原理

1. **启动目标程序**：启动器启动 G4VNVLBS.exe
2. **等待窗口出现**：补丁系统等待主窗口出现
3. **递归扫描**：扫描所有窗口和子窗口
4. **文本替换**：将找到的越南文文本替换为中文
5. **持续监控**：每2秒检查一次，确保动态更新的文本也被翻译

## 如果某些文本仍然显示为越南文

如果某些文本仍然显示为越南文或乱码，可能的原因：

1. **文本不在映射表中**：需要添加到 `TranslationMap`
2. **文本是图片**：某些"文本"实际上是图片，无法通过文本替换修改
3. **文本是动态生成的**：某些文本可能是程序动态生成的，需要特殊处理
4. **编码问题**：乱码可能是编码问题，需要检查目标程序的编码

## 添加新的翻译

如果需要添加新的翻译，编辑 `UIChinesePatcher.cs` 文件中的 `TranslationMap`：

```csharp
private static readonly Dictionary<string, string> TranslationMap = new Dictionary<string, string>
{
    // 添加新的翻译
    { "越南文文本", "中文翻译" },
    // ...
};
```

## 调试信息

补丁系统会在控制台输出调试信息：

- `"DEBUG: Starting UI Chinese patcher..."` - 补丁系统启动
- `"UIChinesePatcher Error: ..."` - 补丁过程中的错误

## 注意事项

1. **性能影响**：持续监控会占用少量CPU资源，但影响很小
2. **延迟**：某些文本可能需要几秒钟才能被翻译
3. **兼容性**：补丁系统适用于大多数Windows Forms控件

## 下一步

1. **重新编译项目**
2. **运行程序**
3. **观察界面是否显示中文**

如果某些文本仍然没有翻译，请告诉我具体的文本内容，我会添加到翻译映射表中。

---

**创建日期：** 2024年  
**状态：** ✅ 已集成到项目中
