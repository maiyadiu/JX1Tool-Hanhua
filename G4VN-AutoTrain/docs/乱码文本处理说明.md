# 乱码文本处理说明

## 问题分析

界面显示的乱码是因为：
1. **编码问题**：越南文在中文Windows系统上显示为乱码
2. **补丁系统需要识别乱码文本**：补丁系统需要能够识别这些乱码文本并翻译为中文

## 解决方案

我已经改进了 `UIChinesePatcher.cs`，添加了：

### 1. 乱码文本映射表

添加了大量乱码文本到中文的映射，包括：

| 乱码文本 | 中文翻译 |
|---------|---------|
| T獨nh_v | 角色名 |
| D.t菇 | 挂机 |
| T. | 综合 |
| T.h | 统计 |
| Bang h閉 | 帮会 |
| LuyÔn cæng | 练功 |
| Nhiễm vô D • tu | 日常任务 |
| Về thµnh | 回城 |
| Tô vong | 死亡 |
| Thu nhẹp | 拾取 |
| ... | ... |

### 2. 改进的翻译算法

- **精确匹配**：首先尝试精确匹配
- **部分匹配**：如果精确匹配失败，尝试部分匹配
- **模糊匹配**：移除标点符号后比较（处理 "Về thµnh:" 这样的情况）
- **智能检测**：只翻译明显是越南文或乱码的文本

### 3. 更积极的补丁策略

- 不仅补丁按钮和标签，还补丁所有文本控件
- 持续监控并更新动态文本
- 增加重试次数和延迟，确保窗口完全加载后再补丁

## 使用方法

**无需额外操作！** 补丁系统会在目标程序启动后自动运行。

## 如果仍有文本未翻译

如果某些乱码文本仍然没有翻译，请：

1. **记录乱码文本**：截图或记录具体的乱码文本
2. **添加到映射表**：编辑 `UIChinesePatcher.cs` 中的 `TranslationMap`
3. **重新编译**：重新编译项目

## 添加新翻译的示例

```csharp
// 在 TranslationMap 中添加
{ "乱码文本", "中文翻译" },
```

例如：
```csharp
{ "新的乱码文本", "新的中文翻译" },
```

## 调试信息

补丁系统会在控制台输出调试信息，包括：
- 补丁过程的错误信息
- 持续监控的错误信息

如果补丁系统没有工作，请检查控制台输出。

## 注意事项

1. **延迟**：补丁系统需要等待窗口完全加载，可能需要几秒钟
2. **持续监控**：补丁系统会每2秒检查一次，确保动态更新的文本也被翻译
3. **性能**：持续监控会占用少量CPU资源，但影响很小

---

**更新日期：** 2024年  
**状态：** ✅ 已添加乱码文本处理
